# === HYPERSPACE DB CONFIGURATION ===

# --- Server Dimensions & Metric ---
# Option 1: Legacy / Classical RAG (OpenAI, BGE-M3)
HS_DIMENSION=1024
HS_METRIC=cosine

# Option 2: Scientific / Native Hyperbolic
# Use 'poincare' for maximum efficiency on compressed hyperbolic vectors.
# HS_DIMENSION=64
# HS_METRIC=poincare

# Legacy alias support (do not remove unless sure)
# HS_DISTANCE_METRIC=poincare

# --- HNSW Engine Tuning ---
# --- Metrics #1 ---
# Database        | Dim   | Metric   | Ins QPS  | Srch QPS | P99 Lat    | Recall(Sys) | MRR   | NDCG  | C1     | C10    | C30    |
# --------------------------------------------------------------------------------------------------------------------------------
# Hyperspace      | 1024  | Cosine   |    24542 |     1036 |    1.73 ms |       89.8% |  1.00 |  0.92 |   1205 |   2931 |   2753 |
# Hyperspace      | 64    | Poincare |   157950 |     2912 |    0.88 ms |       99.8% |  1.00 |  0.92 |   4893 |   2784 |   2326 |
# HS_HNSW_M=48
# HS_HNSW_EF_CONSTRUCT=200
# HS_HNSW_EF_SEARCH=200

# --- HNSW Engine Tuning ---
# --- Metrics #2 ---
# Database        | Dim   | Metric   | Ins QPS  | Srch QPS | P99 Lat    | Recall(Sys) | MRR   | NDCG  | C1     | C10    | C30    |
# --------------------------------------------------------------------------------------------------------------------------------
# Hyperspace      | 1024  | Cosine   |    23662 |      995 |    2.36 ms |       99.8% |  1.00 |  0.92 |   1146 |   2761 |   2473 |
# Hyperspace      | 64    | Poincare |   158675 |     2777 |    1.52 ms |       99.9% |  1.00 |  0.92 |   4577 |   2725 |   2401 |
HS_HNSW_M=64
HS_HNSW_EF_CONSTRUCT=400
HS_HNSW_EF_SEARCH=400

# --- Durability & Safety ---
# Options: async (default), batch (100ms lag), strict (fsync every write)
# Controls the trade-off between write speed and data safety.
HYPERSPACE_WAL_SYNC_MODE=batch
# Interval for Batch mode in milliseconds
HYPERSPACE_WAL_BATCH_INTERVAL=100

# --- Indexing Performance ---
# Number of parallel threads for HNSW graph construction
# 1 = Serial (best quality/recall, slower indexing)
# 0 = Auto (uses all CPU cores, faster but lower recall due to race conditions)
# Recommended: 1 for production, 0 for bulk imports where recall can be sacrificed
HS_INDEXER_CONCURRENCY=8

# --- Storage & Quantization ---
# Options: none, scalar (i8), binary (1 bit)
# Note: Scalar quantization clamps values to [-1, 1]. Use 'none' for unbounded L2 vectors if you care about magnitude > 1.
HS_QUANTIZATION_LEVEL=scalar

# --- Graph Optimization (Compaction) ---
# Automatic graph rebuild interval in hours (0 = disabled)
# Rebuilds the HNSW graph sequentially for maximum quality
# Recommended: 24-48 hours for production systems with high write load
# Set to 0 to disable automatic optimization
HS_OPTIMIZE_INTERVAL_HOURS=0


# --- Security ---
HYPERSPACE_API_KEY=I_LOVE_HYPERSPACEDB

# === EMBEDDING PIPELINE CONFIGURATION ===
# Provide vectors automatically (InsertText).
HYPERSPACE_EMBED=False

# Provider: 'local' (ONNX), 'openai', 'cohere', 'mistral', 'voyage', 'gemini', 'openrouter'
HYPERSPACE_EMBED_PROVIDER=local

# --- Local ONNX Model (Provider=local) ---
# Path to .onnx file
# HYPERSPACE_MODEL_PATH=./models/v5_Embedding_128d.onnx
# HYPERSPACE_TOKENIZER_PATH=./models/v5_Embedding_Tokenizer.json
# HYPERSPACE_EMBED_DIM=128

# --- Remote API (Provider=openai/cohere/etc) ---
# HYPERSPACE_API_KEY_EMBED=sk-... (Or use OPENAI_API_KEY)
# HYPERSPACE_EMBED_MODEL=text-embedding-3-small
# HYPERSPACE_API_BASE=... (Optional base URL override)

# --- System Tuning ---
# Jemalloc configuration for memory usage vs CPU trade-off.
# background_thread:true enables background memory reclamation.
# dirty_decay_ms:0 releases unused memory immediately (low RAM, higher CPU).
# dirty_decay_ms:10000 (default) keeps memory for reuse (high RAM, lower CPU).
MALLOC_CONF=background_thread:true,dirty_decay_ms:5000,muzzy_decay_ms:5000

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Stress Report</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #0f172a; --card-bg: #1e293b; --text: #f8fafc; --accent: #38bdf8; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 2rem; margin: 0; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
        .card { background: var(--card-bg); padding: 1.5rem; border-radius: 1rem; border: 1px solid #334155; margin-bottom: 2rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        canvas { max-height: 450px; width: 100% !important; }
        h1 { text-align: center; color: var(--accent); margin-bottom: 2rem; }
        h2 { font-size: 1.1rem; color: #94a3b8; margin-top: 0; border-bottom: 1px solid #334155; padding-bottom: 0.5rem; }
    </style>
</head>
<body>
    <h1>Vector DB Stress Test Metrics</h1>
    <div class="grid">
        <div class="card"><h2>Search Throughput (Total QPS)</h2><canvas id="sChart"></canvas></div>
        <div class="card"><h2>Insert Throughput (Total QPS)</h2><canvas id="iChart"></canvas></div>
    </div>
    <div class="card">
        <h2>Scalability Efficiency (%) - Search</h2>
        <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 1rem;">(Percentage of linear speedup. Higher is better. Labels show % of core utilization and diff from leader)</p>
        <canvas id="eChart"></canvas>
    </div>
    <script>
        const concs = [1, 10, 50, 100, 500, 1000];
        const effConcs = [1, 10, 50, 100, 500, 1000, 1100];
        const commonOptions = { 
            responsive: true, 
            maintainAspectRatio: false,
            plugins: { legend: { labels: { color: '#f1f5f9', font: { family: 'Inter' } } } },
            scales: { 
                y: { grid: { color: '#334155' }, ticks: { color: '#94a3b8' } }, 
                x: { grid: { color: '#334155' }, ticks: { color: '#94a3b8' } } 
            } 
        };

        // Data Labels Plugin
        const topLabelsPlugin = {
            id: 'topLabels',
            afterDatasetsDraw(chart) {
                if (chart.canvas.id !== 'eChart') return;
                const { ctx, data } = chart;
                ctx.save();
                ctx.textAlign = 'center';
                ctx.textBaseline = 'bottom';
                
                data.datasets.forEach((dataset, i) => {
                    const meta = chart.getDatasetMeta(i);
                    meta.data.forEach((bar, index) => {
                        const val = dataset.data[index];
                        if (val <= 0) return;

                        // Find leader for this concurrency point
                        let leaderVal = 0;
                        data.datasets.forEach(ds => { leaderVal = Math.max(leaderVal, ds.data[index]); });
                        
                        // Value label
                        ctx.font = 'bold 11px Inter';
                        ctx.fillStyle = '#fff';
                        ctx.fillText(val.toFixed(1) + '%', bar.x, bar.y - 18);
                        
                        // Comparison label
                        if (leaderVal > 0) {
                            const isLeader = val === leaderVal;
                            const diff = isLeader ? 'Leader' : '-' + ((leaderVal - val) / leaderVal * 100).toFixed(0) + '%';
                            ctx.font = '9px Inter';
                            ctx.fillStyle = isLeader ? '#10b981' : '#f87171';
                            ctx.fillText(diff, bar.x, bar.y - 6);
                        }
                    });
                });
                ctx.restore();
            }
        };

        new Chart(document.getElementById('sChart'), { 
            type: 'line', 
            data: { labels: concs, datasets: [{"label": "Hyperspace", "data": [4751.732064332928, 6090.140321531456, 5848.809336220806, 5627.9061654248335, 5901.602068928642, 5895.8282377614905], "borderColor": "#22d3ee", "tension": 0.1}, {"label": "Qdrant", "data": [788.8927289920106, 3628.9263473921687, 3436.0023363777786, 4250.825095887468, 4117.918667673982, 2142.0066911153], "borderColor": "#fac05e", "tension": 0.1}, {"label": "Milvus", "data": [453.18404626853106, 3995.26204266543, 4609.930746141359, 4901.219081117243, 2813.192473746446, 3453.8261280219303], "borderColor": "#818cf8", "tension": 0.1}, {"label": "Weaviate", "data": [112.0292205732601, 703.8367566116257, 907.0452019186271, 910.5569625639287, 855.6812689767843, 838.3500771330106], "borderColor": "#f472b6", "tension": 0.1}] }, 
            options: commonOptions 
        });
        new Chart(document.getElementById('iChart'), { 
            type: 'line', 
            data: { labels: concs, datasets: [{"label": "Hyperspace", "data": [32482.609820282116, 49066.28732932159, 48066.74306669723, 53815.00731979887, 38995.95936681251, 23784.83823626148], "borderColor": "#22d3ee", "tension": 0.1}, {"label": "Qdrant", "data": [1980.3631526361685, 2202.7528528676144, 2101.249541668731, 2125.186719386799, 2087.0096548299402, 1962.2552885005625], "borderColor": "#fac05e", "tension": 0.1}, {"label": "Milvus", "data": [16632.95505422371, 29308.846311608577, 26919.41959930582, 31485.057692148897, 24106.73324562659, 17226.079396038454], "borderColor": "#818cf8", "tension": 0.1}, {"label": "Weaviate", "data": [1101.7392427912034, 622.498415630767, 714.6623343388713, 630.6468516771832, 759.4119839670309, 510.52287385677454], "borderColor": "#f472b6", "tension": 0.1}] }, 
            options: commonOptions 
        });
        new Chart(document.getElementById('eChart'), { 
            type: 'bar', 
            data: { labels: effConcs, datasets: [{"label": "Hyperspace", "data": [0, 12.816674507480716, 2.4617588942451833, 1.1843904684080515, 0.24839793107135724, 0.12407745550335816, 0], "backgroundColor": "#22d3ee", "hoverBackgroundColor": "#fff"}, {"label": "Qdrant", "data": [0, 46.000250909004386, 8.710949436099003, 5.388343610821286, 1.043974298745422, 0.2715206532391545, 0], "backgroundColor": "#fac05e", "hoverBackgroundColor": "#fff"}, {"label": "Milvus", "data": [0, 88.15981223438887, 20.344629446243907, 10.815074187790493, 1.241523172278447, 0.7621243855471889, 0], "backgroundColor": "#818cf8", "hoverBackgroundColor": "#fff"}, {"label": "Weaviate", "data": [0, 62.8261763323936, 16.193011024752714, 8.12785233981416, 1.5276037173127028, 0.7483316163793018, 0], "backgroundColor": "#f472b6", "hoverBackgroundColor": "#fff"}] }, 
            options: {
                ...commonOptions,
                plugins: { ...commonOptions.plugins },
                barPercentage: 0.8,
                categoryPercentage: 0.8
            },
            plugins: [topLabelsPlugin]
        });
    </script>
</body>
</html>
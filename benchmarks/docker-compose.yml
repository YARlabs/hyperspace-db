services:
  # HyperspaceDB (Pre-built)
  # hyperspace:
  #   image: glukhota/hyperspace-db:latest
  #   pull_policy: always
  #   ports:
  #     - "50051:50051"
  #     - "50050:50050"
  #   environment:
  #     - RUST_LOG=info
  #     - HS_PORT=50051
  #     - HS_DIMENSION=1024
  #   # volumes:
  #   #   - hyperspace_data:/data
  #   networks:
  #     - benchmark_net
  #   healthcheck:
  #     test: ["CMD", "curl", "-f", "http://localhost:50050/api/metrics"]
  #     interval: 5s
  #     timeout: 3s
  #     retries: 10

  # Qdrant
  qdrant:
    image: qdrant/qdrant:latest
    ports:
      - "6333:6333"
      - "6334:6334"
    # volumes:
    #   - qdrant_data:/qdrant/storage
    networks:
      - benchmark_net
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:6333/health"]
      interval: 5s
      timeout: 3s
      retries: 10

  # Weaviate
  weaviate:
    image: semitechnologies/weaviate:latest
    ports:
      - "8080:8080"
      - "50052:50051" # Map internal 50051 to host 50052 to avoid conflict
    environment:
      - QUERY_DEFAULTS_LIMIT=25
      - AUTHENTICATION_ANONYMOUS_ACCESS_ENABLED=true
      - PERSISTENCE_DATA_PATH=/var/lib/weaviate
      - DEFAULT_VECTORIZER_MODULE=none
      - CLUSTER_HOSTNAME=node1
      - GRPC_PORT=50051 # Internal gRPC port
    # volumes:
    #   - weaviate_data:/var/lib/weaviate
    networks:
      - benchmark_net
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/v1/.well-known/ready"]
      interval: 5s
      timeout: 3s
      retries: 10

  # Milvus (Standalone)
  milvus-etcd:
    image: quay.io/coreos/etcd:v3.5.17
    environment:
      - ETCD_AUTO_COMPACTION_MODE=revision
      - ETCD_AUTO_COMPACTION_RETENTION=1000
      - ETCD_QUOTA_BACKEND_BYTES=4294967296
      - ETCD_SNAPSHOT_COUNT=50000
    # volumes:
    #   - milvus_etcd:/etcd
    command: etcd -advertise-client-urls=http://127.0.0.1:2379 -listen-client-urls http://0.0.0.0:2379 --data-dir /etcd
    networks:
      - benchmark_net

  milvus-minio:
    image: minio/minio:latest
    environment:
      MINIO_ACCESS_KEY: minioadmin
      MINIO_SECRET_KEY: minioadmin
    # volumes:
    #   - milvus_minio:/minio_data
    command: minio server /minio_data
    networks:
      - benchmark_net
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
      interval: 30s
      timeout: 20s
      retries: 3

  milvus:
    image: milvusdb/milvus:latest
    command: ["milvus", "run", "standalone"]
    environment:
      ETCD_ENDPOINTS: milvus-etcd:2379
      MINIO_ADDRESS: milvus-minio:9000
    # volumes:
    #   - milvus_data:/var/lib/milvus
    ports:
      - "19530:19530"
      - "9091:9091"
    depends_on:
      - milvus-etcd
      - milvus-minio
    networks:
      - benchmark_net
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9091/healthz"]
      interval: 10s
      timeout: 5s
      retries: 10

  # ChromaDB
  chroma:
    image: chromadb/chroma:latest
    ports:
      - "8000:8000"
    environment:
      - IS_PERSISTENT=FALSE
      - ALLOW_RESET=TRUE
    networks:
      - benchmark_net
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/api/v1/heartbeat"]
      interval: 5s
      timeout: 3s
      retries: 10

# volumes:
#   hyperspace_data:
#   qdrant_data:
#   weaviate_data:
#   milvus_etcd:
#   milvus_minio:
#   milvus_data:

networks:
  benchmark_net:
    driver: bridge
